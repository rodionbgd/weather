!function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=0,n=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.options=t,this.elem=e,this.sliderElem=void 0}var o,r;return o=n,(r=[{key:"removeSlider",value:function(){!window.TOUCH&&this.sliderElem&&this.sliderElem.parentNode.removeChild(this.sliderElem)}},{key:"createSlider",value:function(){for(var e="",t=1;t<25;t+=1)e+='<div class="wrap">\n                                    <p>'.concat(new Date(1e3*this.options[t].dt).getHours(),":00</p>"),this.options[t].pop>.45?e+="<p>".concat(Math.round(100*this.options[t].pop),"%</p>"):e+="<p>&nbsp;</p>",e+='<img src="./icons/'.concat(this.options[t].weather[0].icon,'_icon.png" alt="">\n                       <p>').concat(Math.round(this.options[t].temp-273.15),"°</p>\n                                </div>");if(window.TOUCH){var n=document.getElementById("slider");return n.innerHTML="",n.dataset.name=this.options.name,void n.insertAdjacentHTML("afterbegin",e)}var o=document.createElement("section");o.dataset.name=this.elem.dataset.name,o.classList.add("slider"),o.id="slider_d",o.insertAdjacentHTML("afterbegin",e),document.body.insertAdjacentElement("afterbegin",o);var r=this.elem.getBoundingClientRect(),a=r.left+(r.width-o.offsetWidth)/2,i=r.top+window.pageYOffset-o.offsetHeight-5;a+o.offsetWidth>window.innerWidth&&(a=window.innerWidth-o.offsetWidth-5),i<5&&(i=5),o.style.left="".concat(a,"px"),o.style.top="".concat(i,"px")}},{key:"renderSlider",value:function(){var e=document.getElementById("slider_d");if(e){var n=e.getBoundingClientRect(),o=e.offsetLeft,r=n.right;e.addEventListener("selectstart",a),e.addEventListener("dragstart",a),e.addEventListener("pointerdown",(function(n){if(!window.TOUCH&&n.target.closest("div")){var i=e.querySelectorAll("div"),l=n.pageX,c=0,s=0;t=n.clientX-i[0].getBoundingClientRect().left+o+e.clientLeft,document.addEventListener("pointermove",u),document.addEventListener("pointerup",(function t(){document.removeEventListener("pointermove",u),e.removeEventListener("scroll",a),document.addEventListener("pointerup",t)})),d(n.pageX)}function d(e){c<s&&i[i.length-1].getBoundingClientRect().right<r||c>s&&i[0].getBoundingClientRect().left>o||(s=c,i.forEach((function(n){n.style.left="".concat(e-t,"px")})))}function u(e){c=e.pageX-l,d(e.pageX)}})),this.sliderElem=e}function a(){return!1}}}])&&e(o.prototype,r),n}();function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=document.getElementById("current-city"),l=document.getElementById("current-city-img"),c=document.getElementById("current-city-wind"),s=document.getElementById("current-city-weather"),d=document.getElementById("current-city-celsius"),u=document.getElementById("current-temp-max"),m=document.getElementById("current-temp-min"),p=document.getElementById("current-city-pressure"),g=document.getElementById("current-city-humidity"),f=document.getElementById("current-city-sunset"),y=document.getElementById("current-city-sunrise"),h=document.getElementById("day"),v=60*(new Date).getTimezoneOffset();function w(e){if(e){i.textContent=e.name;var t=e.current.weather[0].icon;l.src="./icons/".concat(t,"_icon.png");var n,o,r=(n=e.current.wind_deg,(o=["north","north-north-east","north-east","east-north-east","east","east-south-east","south-east","south-south-east","south","south-south-west","south-west","west-south-west","west","west-north-west","north-west","north-north-west"])[Math.floor((n+11)/(360/o.length))%o.length]);c.children[0].src="./icons/wind/icons8-".concat(r,"-80.png");var w=r.split("-").map((function(e){switch(e[0]){case"n":return"С";case"s":return"Ю";case"w":return"З";case"e":return"В";default:return""}})).join("");c.children[1].innerHTML="".concat(e.current.wind_speed.toFixed(1)," м/с ").concat(w),h.textContent=(new Date).toLocaleDateString("ru-RU",{month:"long",day:"numeric",hour:"numeric",minute:"numeric"}),s.textContent=e.current.weather[0].description[0].toUpperCase()+e.current.weather[0].description.substr(1),d.textContent="".concat((e.current.temp-273.15).toFixed(0),"°");var E=Math.max.apply(Math,a(e.hourly.slice(0,25).map((function(e){return e.temp})))),S=Math.min.apply(Math,a(e.hourly.slice(0,25).map((function(e){return e.temp}))));u.innerHTML="".concat(Math.round(E-273.15).toFixed(0),"° "),m.innerHTML="/ ".concat(Math.round(S-273.15).toFixed(0),"°"),p.textContent="".concat((e.current.pressure/1.36).toFixed(0)," мм рт. ст."),g.textContent="".concat(e.current.humidity," %");var _={hour:new Date(1e3*(e.current.sunrise+e.timezone_offset+v)).getHours(),minute:new Date(1e3*(e.current.sunrise+e.timezone_offset+v)).getMinutes()},b={hour:new Date(1e3*(e.current.sunset+e.timezone_offset+v)).getHours(),minute:new Date(1e3*(e.current.sunset+e.timezone_offset+v)).getMinutes()};y.textContent="".concat("0".concat(_.hour).slice(-2),":").concat("0".concat(_.minute).slice(-2)),f.textContent="".concat("0".concat(b.hour).slice(-2),":").concat("0".concat(b.minute).slice(-2))}}var E,S,_=document.getElementById("city-list"),b=document.getElementById("map"),L="";function C(e){var t=window.WE.tileLayer("https://webglearth.github.io/webglearth2-offline/{z}/{x}/{y}.jpg",{tileSize:1024,bounds:[[-90,-180],[90,180]],minZoom:0,maxZoom:1,tms:!0});S||(S=window.WE.map("map",{center:[e.latitude,e.longitude],zoom:1,tilting:!0,scrollWheelZoom:!1})),t.addTo(S),S.setView([e.latitude,e.longitude],1)}function O(e,t,o){l.src="icons/load.gif",t&&fetch("https://api.openweathermap.org/data/2.5/onecall"+"?lat=".concat(e.latitude,"&lon=").concat(e.longitude)+"&exclude=minutely,daily,alerts&lang=ru&appid=".concat("5df917b322441cc9e193178bf51efa31")).then((function(e){return e.json()})).then((function(r){var i=r;i.name=t,o&&w(i),function(e){var t=!1,n=_.querySelector(".city_list__profile[data-name=".concat(e.name,"]"));Object.prototype.hasOwnProperty.call(localStorage,e.name)&&n&&(t=!0),localStorage.setItem(e.name,JSON.stringify(e));var o=Math.max.apply(Math,a(e.hourly.slice(0,25).map((function(e){return e.temp})))),r=Math.min.apply(Math,a(e.hourly.slice(0,25).map((function(e){return e.temp})))),i="./icons/".concat(e.current.weather[0].icon,"_icon.png"),l='\n                    <section class="city_list__profile" data-name="'.concat(e.name,'">\n                        <h4 class="city_list__name">').concat(e.name,'</h4>\n                        <img src="').concat(i,'" alt="" class="city_list__picture">\n                        <span class="city_list__value">').concat(+(o-273.15).toFixed(),"&deg\n                        / ").concat(+(r-273.15).toFixed(),"&deg</span>\n                    </section>\n");Object.keys(localStorage).length&&(_.style.display="flex"),Object.keys(localStorage).length>5&&(localStorage.removeItem(_.firstElementChild.dataset.name),_.firstElementChild.remove()),t?(n.insertAdjacentHTML("afterend",l),n.remove()):_.insertAdjacentHTML("beforeend",l)}(i),window.TOUCH&&o&&new n(null,i.hourly).createSlider(),!window.TOUCH&&i.name!==L&&o&&(function(e){S&&(S.fitBounds([[e.latitude-90,e.longitude-90],[e.latitude+90,e.longitude+90]]),S.panInsideBounds([[e.latitude-89,e.longitude-89],[e.latitude+89,e.longitude+89]],{heading:1,tilt:0,duration:1.5}))}(e),function(e,t){if(E)return E.setLatLng([e.latitude,e.longitude]),void E.bindPopup('<h4 class="marker">'.concat(t,"</h4>"),{closeButton:!1}).openPopup();b.style.overflow="visible",(E=window.WE.marker([e.latitude,e.longitude]).addTo(S)).bindPopup('<h4 class="marker">'.concat(t,"</h4>"),{closeButton:!1}).openPopup()}(e,i.name),L=i.name)}))}var T=document.getElementById("search"),x=document.getElementById("search-button"),B=document.getElementById("search-form");function I(e){(new window.google.maps.Geocoder).geocode({address:e},(function(t,n){e&&(n===window.google.maps.GeocoderStatus.OK?O({latitude:t[0].geometry.location.lat(),longitude:t[0].geometry.location.lng()},t[0].address_components[0].long_name,!0):alert("Неправильный город"),T&&(T.value="",T.blur(),T.focus(),x.style.display="none"))}))}function H(){localStorage.length>5&&localStorage.clear(),Object.entries(localStorage).forEach((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw r}}return a}}(t,n)||r(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],i=o[1];O({latitude:JSON.parse(i).lat,longitude:JSON.parse(i).lon},a,!1)}))}function M(e){var t=document.getElementById("loading");e<=0?t.style.display="none":(t.style.opacity="".concat(e),setTimeout((function(){M(e-.1)}),200))}window.googleAutoComplete=function(){T.value="";var e=!1,t=new window.google.maps.places.Autocomplete(T,{fields:["formatted_address","geometry","name"],strictBounds:!1,types:["(cities)"]});T.addEventListener("input",(function(){T.value?x.style.display="flex":x.style.display="none"})),B.addEventListener("keydown",(function(t){T.value&&"Enter"===t.key&&(I(T.value),e=!0)})),x.addEventListener("click",(function(){T.value&&(I(T.value),e=!0)})),t.addListener("place_changed",(function(){T.value&&(e?e=!e:I(T.value))}))},window.TOUCH=window.matchMedia("(any-hover:none)").matches;var A,j=document.querySelector(".header__title");document.addEventListener("DOMContentLoaded",(function(){if(!window.TOUCH){var e=document.getElementById("weather-items");e.firstElementChild.remove(),s.insertAdjacentElement("afterend",e)}M(1);var t=document.createElement("script");t.type="text/javascript",t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFgn8EeO8dUIZuqg7AD-lnG_Yc5jCT4Ek&libraries=places&callback=googleAutoComplete",document.head.append(t);var n={latitude:55.7558,longitude:37.6173};function o(){var e;if(localStorage.length){var t=JSON.parse(localStorage.getItem(localStorage.key(localStorage.length-1)));n={latitude:t.lat,longitude:t.lon},e=t.name}window.TOUCH||C(n),e||(e="Москва"),O(n,e,!0),H()}navigator.geolocation&&navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){window.TOUCH||C(e.coords),n={latitude:e.coords.latitude,longitude:e.coords.longitude},function(e){var t=new window.google.maps.LatLng(e.latitude,e.longitude);(new window.google.maps.Geocoder).geocode({latLng:t},(function(t,n){if(n===window.google.maps.GeocoderStatus.OK&&t[1]){for(var o,r,a,i=null,l=null,c=null,s=0,d=t.length;s<d;s+=1){var u=t[s];if(l||"locality"!==u.types[0]){if(l||c||"administrative_area_level_1"!==u.types[0])i||"country"!==u.types[0]||(i=u.address_components[0].long_name);else for(o=0,r=u.address_components.length;o<r;o+=1)if("administrative_area_level_1"===(a=u.address_components[o]).types[0]){c=a.long_name;break}}else for(o=0,r=u.address_components.length;o<r;o+=1)if("locality"===(a=u.address_components[o]).types[0]){l=a.long_name;break}if(l&&i)break}l&&O(e,l,!0)}}))}(e.coords),H()}),o,{enableHighAccuracy:!0,maximumAge:6e4,timeout:5e3}):o()})),document.addEventListener("pointerdown",(function(e){var t=e.target.closest(".city_list__profile");if(t){if(window.TOUCH&&i.textContent!==t.dataset.name&&new n(t,JSON.parse(localStorage[t.dataset.name]).hourly).createSlider(),w(JSON.parse(localStorage[t.dataset.name])),window.TOUCH)return;var o=!1;if(A&&(A.removeSlider(),A.sliderElem&&A.sliderElem.dataset.name===t.dataset.name&&(o=!0,A=null)),document.addEventListener("dragstart",(function(e){return e.preventDefault()})),localStorage.length>1){var r=t.getBoundingClientRect(),a=e.clientX,l=e.pageX;t.setAttribute("style",""),t.style.position="relative",t.style.zIndex="".concat(1e3);var c=function(e){t.style.left="".concat(e.pageX-a,"px"),t.style.opacity="".concat(1-2*Math.abs((r.left-t.getBoundingClientRect().left)/(r.left-r.width/2)))};document.addEventListener("pointermove",c),document.addEventListener("pointerup",(function e(n){if(document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",e),Math.abs(l-n.clientX)>r.width/2)return Object.prototype.hasOwnProperty.call(localStorage,t.dataset.name)&&delete localStorage[t.dataset.name],Object.keys(localStorage).length||(document.querySelector(".city_list").style.display="none"),A&&!window.TOUCH&&(A.removeSlider(),A=null),window.TOUCH&&t.classList.toggle("city_list__profile_no-scroll"),void t.remove();t.style.transition="left 0.5s, opacity 0.5s",t.style.left="".concat(0,"px"),t.style.opacity="".concat(1),t.setAttribute("style","")})),t.addEventListener("contextmenu",(function(e){return e.preventDefault()}))}o||window.TOUCH||((A=new n(t,JSON.parse(localStorage[t.dataset.name]).hourly)).createSlider.call(A),A.renderSlider.call(A))}else window.TOUCH||t||!A||e.target.closest(".slider")===A.sliderElem||(A.removeSlider(),A=null)})),document.body.addEventListener("selectstart",(function(e){return e.preventDefault()})),B.addEventListener("submit",(function(e){return e.preventDefault()})),j.addEventListener("pointerenter",(function(){j.querySelector("img").src="icons/header_over_icon.png"})),j.addEventListener("pointerleave",(function(){j.querySelector("img").src="icons/header_out_icon.png"})),j.addEventListener("click",(function(){localStorage[i.innerHTML]&&O({latitude:JSON.parse(localStorage[i.innerHTML]).lat,longitude:JSON.parse(localStorage[i.innerHTML]).lon},JSON.parse(localStorage[i.innerHTML]).name,!0)}))}();